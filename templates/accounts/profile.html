{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="forum-wrapper">
    <div class="profile-banner">
        <div class="profile-banner-bg"></div>
        <div class="profile-banner-content container">
            <div class="profile-avatar">
                {% if usuario.avatar %}
                    <img src="{{ usuario.avatar.url }}" alt="Avatar" class="avatar" />
                {% else %}
                    <img src="{% static 'images/default-avatar.png' %}" alt="Avatar" class="avatar" />
                {% endif %}
            </div>
            <div class="profile-user-info">
                <h2 class="profile-username">{{ usuario.username }}</h2>
                <div class="profile-role">
                    <span class="user-link" style="color:#1976d2;">
                        {{ usuario.apelido|default:"Membro" }}
                    </span>
                </div>
                <div class="profile-meta">
                    <span class="profile-meta-item">
                        Entrou em {{ data_cadastro|date:"d/m/Y" }}
                    </span>
                    {% if ultimo_acesso %}
                        <span class="profile-meta-item">
                            Última visita: {{ ultimo_acesso|date:"d/m/Y H:i" }}
                        </span>
                    {% endif %}
                </div>
            </div>
            {% if user.is_authenticated %}
            <div class="profile-actions">
                {% if is_own_profile %}
                    <a href="{% url 'editar_perfil' %}" class="btn btn-primary">Editar Perfil</a>
                {% else %}
                    <form method="post" action="{% url 'seguir_usuario' usuario.username %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn {% if seguindo %}btn-secondary{% else %}btn-primary{% endif %}">
                            {% if seguindo %}Deixar de Seguir{% else %}Seguir{% endif %}
                        </button>
                    </form>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="container" style="display:flex; gap:32px; margin-top:32px;">
        <!-- Sidebar -->
        <aside class="forum-sidebar" style="flex:1; min-width:260px;">
            <div class="sidebar-section">
                <div class="section-header">
                    <h3>Sobre</h3>
                </div>
                <div class="section-content">
                    {% if usuario.biografia %}
                        <div style="margin-bottom: 16px;">
                            <p>{{ usuario.biografia|linebreaks }}</p>
                        </div>
                    {% endif %}
                    
                    {% if usuario.data_nascimento %}
                        <div><b>Data de Nascimento:</b> {{ usuario.data_nascimento|date:"d/m/Y" }}</div>
                    {% endif %}
                    {% if usuario.localizacao %}
                        <div><b>Localização:</b> {{ usuario.localizacao }}</div>
                    {% endif %}
                    {% if usuario.objetivo %}
                        <div><b>Objetivo:</b> {{ usuario.objetivo }}</div>
                    {% endif %}
                    {% if usuario.peso %}
                        <div><b>Peso:</b> {{ usuario.peso }}kg</div>
                    {% endif %}
                    {% if usuario.altura %}
                        <div><b>Altura:</b> {{ usuario.altura }}cm</div>
                    {% endif %}
                    {% if usuario.site %}
                        <div><b>Website:</b> <a href="{{ usuario.site }}" target="_blank">{{ usuario.site }}</a></div>
                    {% endif %}
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-header">
                    <h3>Seguidores ({{ total_seguidores }})</h3>
                </div>
                <div class="section-content">
                    {% if ultimos_visitantes %}
                        <div style="margin-top: 12px;">
                            <small><b>Últimos visitantes:</b></small>
                            <div class="online-members" style="margin-top:8px;">
                                {% for visita in ultimos_visitantes %}
                                    <a href="{% url 'perfil' username=visita.visitante.username %}" title="{{ visita.visitante.username }} - {{ visita.timestamp|date:'d/m/Y' }}">
                                        {% if visita.visitante.avatar %}
                                            <img src="{{ visita.visitante.avatar.url }}" alt="{{ visita.visitante.username }}" 
                                                 class="avatar" style="width:32px; height:32px; margin-right:4px;">
                                        {% else %}
                                            <img src="{% static 'images/default-avatar.png' %}" alt="{{ visita.visitante.username }}" 
                                                 class="avatar" style="width:32px; height:32px; margin-right:4px;">
                                        {% endif %}
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </aside>
        
        <!-- Conteúdo principal -->
        <main class="forum-main" style="flex:3;">
            <div class="profile-stats forum-info" style="display:flex; gap:32px; margin-bottom:24px;">
                <div>
                    <div class="stat-label">Posts</div>
                    <div class="stat-value">{{ usuario.total_itens|default:"0" }}</div>
                </div>
                <div>
                    <div class="stat-label">Respostas</div>
                    <div class="stat-value">{{ usuario.answers|default:"0" }}</div>
                </div>
                <div>
                    <div class="stat-label">Reputação</div>
                    <div class="stat-value">{{ usuario.reputacao|default:"0" }}</div>
                </div>
            </div>

            <div class="profile-activity forum-info">
                <h3>Atividades recentes</h3>
                {% if atividades %}
                    {% for atividade in atividades %}
                        <div class="post-item" style="margin-bottom:18px;">
                            <span class="post-title">
                                <a href="{{ atividade.url }}">{{ atividade.titulo }}</a>
                            </span>
                            <div class="post-meta">{{ atividade.data|date:"d/m/Y H:i" }}</div>
                            <div class="post-content">{{ atividade.conteudo }}</div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="post-item" style="margin-bottom:18px; text-align:center; color:#bbb;">
                        <p>Nenhuma atividade recente encontrada.</p>
                        {% if is_own_profile %}
                            <p><small>Comece participando do fórum para ver suas atividades aqui!</small></p>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </main>
    </div>
</div>
{% endblock %}